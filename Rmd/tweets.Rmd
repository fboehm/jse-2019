---
title: "Tweets"
author: "Frederick J. Boehm"
date: "4/9/2020"
output: html_document
---

## Goals

1. Write a R script to query twitter streaming api to get 1 percent sample over 5'.
1. Demonstrate how to set up a crontab to execute script every 5'.
1. Verify that crontab approach works by running it on my computer for, say, 15'.
    1. Cautions about twitter databases: deletions and amendments to tweets
1. Examine structure of JSON obtained from api. 
1. Create phony JSON to represent a collection of tweets.
    1. Use lorem ipsum for text of tweets

## R code to query twitter streaming api

Install `rtweet` package from CRAN.

```{r, eval = FALSE}
install.packages("rtweet")
install.packages("lubridate")
```

```{r}
rtweet::stream_tweets(
  timeout = (60 * 5),
  parse = TRUE,
  file_name = paste0("../data/", lubridate::now(), "-tweets")
)
```

## Parse json file

```{r}
library(magrittr)
```


```{r}
tweets <- rtweet::parse_stream("../data/2020-04-09 16:31:44-tweets.json") %>%
  dplyr::filter(lang == "en") %>%
  tidytext::unnest_tokens(output = word, input = text)
```

## Prepare document-term matrix from tweet words

```{r}
# create a twitter-specific stop word list
twitter_stop <- tibble::tibble(word = c("https", "http", "t.co"))
# get a list of english language words and names
library(qdapDictionaries) # contains object GradyAugmented
```

```{r}
# https://www.tidytextmining.com/topicmodeling.html#library-heist
library(tidytext)
word_counts <- tweets %>% 
  dplyr::select(status_id, word) %>%
  dplyr::anti_join(stop_words) %>%
  dplyr::anti_join(twitter_stop) %>%
  dplyr::filter(word %in% GradyAugmented) %>%
  dplyr::count(status_id, word, sort = TRUE) %>%
  dplyr::ungroup()
```

### Colophon

This report was generated on `r Sys.time()` using the following computational environment and dependencies: 

```{r colophon, cache = FALSE}
# which R packages and versions?
if ("devtools" %in% installed.packages()) devtools::session_info()
```

The current Git commit details are:

```{r}
# what commit is this file at? 
if ("git2r" %in% installed.packages() & git2r::in_repository(path = ".")) git2r::repository(here::here())  
```
